<div class="inventory-chef-page">
  <section class="hero-card">
    <div class="hero-content">
      <p class="eyebrow">Panel exclusivo para Chefs</p>
      <h1>Consulta de inventario</h1>
      <p class="subtitle">
        Visualiza el inventario disponible, identifica ingredientes cr√≠ticos y planifica tus recetas con informaci√≥n en tiempo real.
      </p>
      <div class="hero-actions">
        <button class="ghost" (click)="refreshData()">
          <span>üîÑ Actualizar datos</span>
        </button>
      </div>
    </div>
    <div class="hero-image">
      <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1200&q=80" alt="Inventario para chef" />
      <div class="image-overlay">
        <div class="overlay-card">
          <p>√çtems cr√≠ticos</p>
          <strong>{{ stats.critical }}</strong>
          <span>Requieren atenci√≥n</span>
        </div>
        <div class="overlay-card">
          <p>Stock total</p>
          <strong>{{ stats.totalUnits | number:'1.0-0' }}</strong>
          <span>Unidades disponibles</span>
        </div>
      </div>
    </div>
  </section>

  <section class="stats-grid">
    <article class="stat-card" *ngFor="let card of statCards">
      <div class="stat-icon">{{ card.icon }}</div>
      <div>
        <p>{{ card.label }}</p>
        <strong>{{ card.value }}</strong>
        <span [class.positive]="card.trend > 0" [class.negative]="card.trend < 0">
          {{ card.trend > 0 ? '+' : ''}}{{ card.trend }}%
        </span>
      </div>
    </article>
  </section>

  <section class="inventory-layout">
    <div class="inventory-panel">
      <header class="panel-header">
        <div class="search-group">
          <input
            type="text"
            placeholder="Buscar Inventario..."
            [(ngModel)]="searchTerm"
            (ngModelChange)="onFiltersChange()"
          />
          <span class="search-icon">üîç</span>
        </div>
        <div class="filters">
          <select [(ngModel)]="categoryFilter" (change)="onFiltersChange()">
            <option value="all">Todas las categor√≠as</option>
            <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
          </select>
          <select [(ngModel)]="restaurantFilter" (change)="onFiltersChange()">
            <option value="all">Todas las sedes</option>
            <option *ngFor="let restaurant of restaurants" [value]="restaurant.id">
              {{ restaurant.name }}
            </option>
          </select>
          <select [(ngModel)]="statusFilter" (change)="onFiltersChange()">
            <option value="all">Todos los estados</option>
            <option value="Disponible">Disponible</option>
            <option value="Cr√≠tico">Cr√≠tico</option>
            <option value="Agotado">Agotado</option>
          </select>
        </div>
      </header>

      <div class="table-wrapper" *ngIf="filteredItems.length; else emptyState">
        <table>
          <thead>
            <tr>
              <th>Art√≠culo</th>
              <th>Restaurante</th>
              <th>Ingrediente</th>
              <th>Existencia</th>
              <th>Categor√≠a</th>
              <th>Proveedor</th>
              <th>√öltima actualizaci√≥n</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let item of filteredItems; trackBy: trackById"
              (click)="selectItem(item)"
              [class.selected]="selectedItem?.id === item.id"
            >
              <td>
                <div class="item-info">
                  <div class="avatar">
                    {{ item.nombre.charAt(0) }}
                  </div>
                  <div>
                    <strong>{{ item.nombre }}</strong>
                    <p>{{ item.descripcion || 'Sin descripci√≥n' }}</p>
                  </div>
                </div>
              </td>
              <td class="location-cell">
                <strong>{{ item.restaurantName }}</strong>
                <p>{{ getRestaurantLocation(item.restaurantId) }}</p>
              </td>
              <td>
                <div class="ingredient-chip">
                  <span>{{ item.ingredientName }}</span>
                  <small>{{ item.unitCode }}</small>
                </div>
              </td>
              <td>
                <div class="quantity">
                  <strong>{{ item.cantidad }}</strong>
                  <span>{{ item.unidad }}</span>
                  <div class="progress-bar">
                    <div class="progress" [style.width.%]="getStockProgress(item)"></div>
                  </div>
                </div>
              </td>
              <td>
                <span class="badge" [ngClass]="getCategoryBadge(item.categoria)">
                  {{ item.categoria }}
                </span>
              </td>
              <td>{{ item.proveedor }}</td>
              <td>{{ formatDate(item.fechaActualizacion) }}</td>
              <td>
                <span class="status-chip" [ngClass]="item.estado.toLowerCase()">
                  {{ item.estado }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <ng-template #emptyState>
        <div class="empty-state">
          <h3>Sin resultados</h3>
          <p>Prueba con otro t√©rmino de b√∫squeda o ajusta los filtros.</p>
        </div>
      </ng-template>
    </div>

    <aside class="insights-panel">
      <div class="detail-card" *ngIf="selectedItem as item; else placeholderCard">
        <div class="detail-cover">
          <img [src]="item.imagen || defaultImage" [alt]="item.nombre" />
          <span class="status-pill" [ngClass]="item.estado.toLowerCase()">{{ item.estado }}</span>
        </div>
        <div class="detail-body">
          <p class="eyebrow">Informaci√≥n detallada</p>
          <h2>{{ item.nombre }}</h2>
          <p class="description">{{ item.descripcion || 'Sin descripci√≥n disponible' }}</p>
          <div class="detail-grid">
            <div>
              <label>Stock actual</label>
              <strong>{{ item.cantidad }} {{ item.unidad }}</strong>
            </div>
            <div>
              <label>Nivel de reorden</label>
              <strong>{{ item.nivelReorden }} {{ item.unidad }}</strong>
            </div>
            <div>
              <label>Ingrediente base</label>
              <strong>{{ item.ingredientName }}</strong>
            </div>
            <div>
              <label>Proveedor</label>
              <strong>{{ item.proveedor }}</strong>
            </div>
            <div>
              <label>Sede operativa</label>
              <strong>{{ item.restaurantName }}</strong>
              <p>{{ getRestaurantLocation(item.restaurantId) }}</p>
            </div>
            <div>
              <label>Fecha de caducidad</label>
              <strong>{{ item.fechaExpiracion ? formatDate(item.fechaExpiracion) : 'Sin fecha' }}</strong>
            </div>
            <div *ngIf="item.lote">
              <label>Lote</label>
              <strong>{{ item.lote }}</strong>
            </div>
            <div *ngIf="item.costoUnitario">
              <label>Costo unitario</label>
              <strong>${{ item.costoUnitario | number:'1.2-2' }}</strong>
            </div>
          </div>
          <div class="notes" *ngIf="item.notas">
            <label>Notas y recomendaciones</label>
            <p>{{ item.notas }}</p>
          </div>
        </div>
      </div>
      <ng-template #placeholderCard>
        <div class="detail-card placeholder">
          <h3>üë®‚Äçüç≥ Selecciona un art√≠culo</h3>
          <p>Visualiza informaci√≥n detallada del inventario disponible para planificar tus recetas.</p>
        </div>
      </ng-template>

      <div class="timeline-card">
        <p class="eyebrow">Movimiento reciente</p>
        <h3>√öltimas actualizaciones</h3>
        <ul>
          <li *ngFor="let item of recentItems">
            <div>
              <strong>{{ item.nombre }}</strong>
              <p>{{ item.restaurantName }} ¬∑ {{ item.proveedor }}</p>
            </div>
            <span>{{ formatDate(item.fechaActualizacion) }}</span>
          </li>
        </ul>
      </div>
    </aside>
  </section>
</div>

