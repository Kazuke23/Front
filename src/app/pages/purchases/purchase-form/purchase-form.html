<div class="purchase-form-page">
  <section class="form-hero">
    <div class="hero-content">
      <p class="eyebrow">Gesti√≥n de Compras</p>
      <h1>{{ pageTitle }}</h1>
      <p>
        Registra y gestiona tus pedidos a proveedores, asegurando el stock necesario para tus operaciones.
      </p>
      <div class="hero-tags">
        <span>Control de inventario</span>
        <span>Optimizaci√≥n de costos</span>
      </div>
    </div>
    <div class="hero-image">
      <img src="https://images.unsplash.com/photo-1587560440462-772956505563?auto=format&fit=crop&w=900&q=80" alt="Formulario de Compras" />
    </div>
  </section>

  <form [formGroup]="form" (ngSubmit)="submit()" class="purchase-form">
    <div class="form-grid">
      <article class="form-card">
        <h2>Detalles del Pedido</h2>
        <div class="fields-grid">
          <label [class]="getFieldClass('restaurant_id')">
            <span>Sede *</span>
            <select formControlName="restaurant_id">
              <option value="">Seleccionar restaurante</option>
              <option *ngFor="let restaurant of restaurants" [value]="restaurant.id">
                {{ restaurant.name }}
              </option>
            </select>
          </label>

          <label [class]="getFieldClass('supplier_id')">
            <span>Proveedor *</span>
            <select formControlName="supplier_id">
              <option value="">Seleccionar proveedor</option>
              <option *ngFor="let supplier of suppliers" [value]="supplier.id">{{ supplier.name }}</option>
            </select>
          </label>

          <label [class]="getFieldClass('status')">
            <span>Estado *</span>
            <select formControlName="status">
              <option *ngFor="let estado of estados" [value]="estado">{{ getStatusLabel(estado) }}</option>
            </select>
          </label>
        </div>
      </article>

      <article class="form-card">
        <h2>√çtems de la Compra</h2>
        <div formArrayName="items" class="items-list">
          <div *ngFor="let itemForm of itemsFormArray.controls; let i = index" [formGroupName]="i" class="item-row">
            <label [class]="getItemFieldClass(i, 'ingredient_id')">
              <span>Ingrediente *</span>
              <select formControlName="ingredient_id">
                <option value="">Seleccionar ingrediente</option>
                <option *ngFor="let ingredient of ingredients" [value]="ingredient.id">
                  {{ ingredient.name }}
                </option>
              </select>
            </label>

            <label [class]="getItemFieldClass(i, 'quantity')">
              <span>Cantidad *</span>
              <input type="number" min="0.01" step="0.01" formControlName="quantity" />
            </label>

            <label [class]="getItemFieldClass(i, 'unit_id')">
              <span>Unidad *</span>
              <select formControlName="unit_id">
                <option *ngFor="let unit of units" [value]="unit.id">
                  {{ unit.code }}
                </option>
              </select>
            </label>

            <label [class]="getItemFieldClass(i, 'price')">
              <span>Precio Unitario *</span>
              <input type="number" min="0" step="0.01" formControlName="price" />
            </label>

            <div class="item-subtotal">
              <span>Subtotal</span>
              <strong>${{ getItemSubtotal(i) | number:'1.2-2' }}</strong>
            </div>

            <button type="button" class="remove-item-btn" (click)="removeItem(i)" *ngIf="itemsFormArray.length > 1">
              üóëÔ∏è
            </button>
          </div>
        </div>
        <button type="button" class="add-item-btn" (click)="addItem()">+ Agregar √çtem</button>

        <div class="total-section">
          <div class="total-display">
            <span>Total de la compra:</span>
            <strong>${{ getTotal() | number:'1.2-2' }}</strong>
          </div>
        </div>
      </article>
    </div>

    <footer class="form-actions">
      <button type="button" class="ghost" (click)="cancel()">Cancelar</button>
      <button type="submit" class="primary">{{ ctaLabel }}</button>
    </footer>
  </form>
</div>
